<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premier Cricket Club</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
<style>
  /* --- VIBRANT LIGHT THEME --- */
  :root {
    --primary-grad: linear-gradient(135deg, #0061ff 0%, #60efff 100%); /* Electric Blue */
    --accent-grad: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%); /* Soft Energy */
    --button-grad: linear-gradient(45deg, #FF512F 0%, #DD2476 100%); /* Vibrant Red/Pink */
    
    --bg-body: #f4f7f6; /* Very light grey/white */
    --bg-card: #ffffff;
    --text-main: #2c3e50; /* Dark Navy (Not Black) */
    --text-light: #7f8c8d;
    --gold: #f1c40f;
    
    --shadow: 0 10px 25px rgba(0,0,0,0.08);
    --radius: 15px;
  }

  body {
    font-family: 'Open Sans', sans-serif;
    background: var(--bg-body);
    color: var(--text-main);
    margin: 0; padding-bottom: 80px;
    min-height: 100vh;
  }

  h1, h2, h3 { font-family: 'Montserrat', sans-serif; font-weight: 800; color: #1a252f; margin-top: 0; }
  h1 { background: var(--primary-grad); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

  /* --- ANIMATIONS --- */
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  .view { animation: fadeInUp 0.5s ease-out; }
  .hidden { display: none !important; }

  /* --- UI CARDS --- */
  .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
  
  .card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 25px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,0.02);
    transition: transform 0.3s ease;
  }
  .card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.12); }

  /* --- INPUTS & BUTTONS --- */
  input, select {
    width: 100%; padding: 14px; margin: 8px 0;
    border: 2px solid #eef2f3; border-radius: 10px;
    background: #fdfdfd; color: var(--text-main);
    font-size: 1rem; transition: 0.3s;
    box-sizing: border-box;
  }
  input:focus, select:focus { border-color: #0061ff; outline: none; background: #fff; }

  .btn {
    background: var(--button-grad);
    color: white; border: none; padding: 14px 20px;
    border-radius: 50px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
    cursor: pointer; width: 100%; margin-top: 15px;
    box-shadow: 0 5px 15px rgba(221, 36, 118, 0.3);
    transition: 0.2s;
  }
  .btn:hover { transform: scale(1.02); box-shadow: 0 8px 20px rgba(221, 36, 118, 0.4); }
  .btn:active { transform: scale(0.98); }

  /* --- HEADER --- */
  header {
    background: white;
    position: sticky; top: 0; z-index: 100;
    box-shadow: 0 4px 20px rgba(0,0,0,0.05);
  }
  .nav-top {
    display: flex; justify-content: space-between; align-items: center;
    padding: 15px 20px; max-width: 1000px; margin: 0 auto;
  }
  .nav-scroll {
    display: flex; gap: 10px; overflow-x: auto; padding: 10px 20px;
    max-width: 1000px; margin: 0 auto;
  }
  .nav-btn {
    background: #f0f2f5; color: var(--text-main); border: none;
    padding: 8px 18px; border-radius: 20px; cursor: pointer;
    font-weight: 600; font-size: 0.85rem; white-space: nowrap; transition: 0.3s;
  }
  .nav-btn.active { background: #0061ff; color: white; box-shadow: 0 4px 10px rgba(0,97,255,0.3); }

  /* --- TICKER --- */
  .ticker-wrap {
    background: #2c3e50; color: white; padding: 12px 0;
    overflow: hidden; white-space: nowrap; font-weight: 600;
  }
  .ticker-content { display: inline-block; padding-left: 100%; animation: ticker 25s linear infinite; }
  @keyframes ticker { 100% { transform: translate3d(-100%, 0, 0); } }

  /* --- TABLES --- */
  table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 10px; }
  th { text-align: left; padding: 12px; color: #7f8c8d; font-size: 0.8rem; text-transform: uppercase; font-weight: 700; }
  td { background: #f8f9fa; padding: 15px; font-size: 0.95rem; border-top: 1px solid #eee; border-bottom: 1px solid #eee; }
  tr td:first-child { border-left: 1px solid #eee; border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
  tr td:last-child { border-right: 1px solid #eee; border-top-right-radius: 10px; border-bottom-right-radius: 10px; }
  tr:hover td { background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transform: scale(1.01); transition: 0.2s; cursor: pointer; }

  /* --- COUNTDOWN HERO --- */
  .hero-card {
    text-align: center;
    background: var(--primary-grad);
    color: white;
  }
  .timer { font-size: 2.5rem; font-family: 'Montserrat', sans-serif; font-weight: 800; text-shadow: 0 4px 10px rgba(0,0,0,0.2); }
  .vs-badge { background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-weight: bold; margin-top: 10px; display: inline-block; }

  /* --- MODAL --- */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(255,255,255,0.8); backdrop-filter: blur(5px);
    display: flex; justify-content: center; align-items: center; z-index: 2000;
  }
  .modal-box {
    background: white; width: 90%; max-width: 500px; padding: 30px;
    border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    max-height: 85vh; overflow-y: auto; border: 1px solid #eee;
  }
  .close-btn { float: right; font-size: 2rem; cursor: pointer; color: #999; line-height: 0.8; }

  /* --- LOADER --- */
  #loader {
    position: fixed; inset: 0; background: white; z-index: 9999;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
  }
  .spinner {
    width: 50px; height: 50px; border: 5px solid #eee;
    border-top-color: #0061ff; border-radius: 50%;
    animation: spin 0.8s infinite linear;
  }
  @keyframes spin { 100% { transform: rotate(360deg); } }

</style>
</head>
<body>

<div id="loader">
  <div class="spinner"></div>
  <p style="margin-top: 20px; color: #0061ff; font-weight: 600;">LOADING CLUB DATA...</p>
</div>

<div id="match-modal" class="modal-overlay hidden">
  <div class="modal-box view">
    <span class="close-btn" onclick="closeModal()">&times;</span>
    <h2 id="m-modal-title" style="color: #0061ff;"></h2>
    <p id="m-modal-info" style="color: #777;"></p>
    <div style="background: #eef2ff; padding: 15px; border-radius: 12px; text-align: center; margin: 15px 0;">
      <span id="m-modal-winner" style="color: #0061ff; font-weight: 800; font-size: 1.2rem;"></span>
    </div>
    <h3 style="font-size: 1rem;">Player Performance</h3>
    <table id="m-modal-stats">
      <thead><tr><th>Player</th><th>Team</th><th>R</th><th>W</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<header>
  <div class="nav-top">
    <h1>CRICKET<span style="color:#0061ff">PRO</span></h1>
    <div onclick="nav('login')" style="cursor: pointer; font-weight: 600; font-size: 0.8rem; color: #0061ff;">üîí MEMBER LOGIN</div>
  </div>
  <div class="nav-scroll">
    <button class="nav-btn active" onclick="nav('home')" id="btn-home">Home</button>
    <button class="nav-btn" onclick="nav('rankings')" id="btn-rankings">Rankings</button>
    <button class="nav-btn" onclick="nav('teams')" id="btn-teams">Teams</button>
    <button class="nav-btn hidden" onclick="nav('admin')" id="btn-admin">Admin</button>
    <button class="nav-btn hidden" onclick="nav('profile')" id="btn-profile">Profile</button>
  </div>
</header>

<div class="ticker-wrap">
  <div class="ticker-content" id="ticker-text">Loading Announcements...</div>
</div>

<div class="container">

  <div id="home" class="view">
    <div class="card hero-card">
      <h3 style="color: white; opacity: 0.9; margin-bottom: 5px;">NEXT MATCH</h3>
      <div class="timer" id="countdown">-- : --</div>
      <div id="next-match-vs" class="vs-badge">Loading Schedule...</div>
    </div>

    <div class="card">
      <h2>Match Center</h2>
      <table id="match-table">
        <thead><tr><th>Date</th><th>Fixture</th><th>Status</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="rankings" class="view hidden">
    <div class="card">
      <h2>Top Players</h2>
      <div style="display: flex; gap: 10px;">
        <select id="f-seas" onchange="renderRankings()"><option value="All">All Seasons</option></select>
        <select id="f-tourn" onchange="renderRankings()"><option value="All">All Tournaments</option></select>
      </div>
      <table id="p-rank-table">
        <thead><tr><th>#</th><th>Name</th><th>Runs</th><th>Wkts</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="teams" class="view hidden">
    <div class="card">
      <h2>Team Standings</h2>
      <table id="t-rank-table">
        <thead><tr><th>Team</th><th>Mat</th><th>Won</th><th>Lost</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div id="login" class="view hidden">
    <div class="card" style="max-width: 400px; margin: 40px auto; text-align: center;">
      <h2 style="color:#0061ff;">Secure Access</h2>
      <select id="login-role" onchange="toggleLogin()">
        <option value="admin">Admin</option>
        <option value="player">Player</option>
      </select>
      
      <div id="admin-login-box">
        <input type="password" id="admin-pass" placeholder="Enter Admin Password">
        <button class="btn" onclick="doAdminLogin()">Enter Admin Panel</button>
      </div>
      
      <div id="player-login-box" class="hidden">
        <select id="login-pid"></select>
        <input type="password" id="player-pass" placeholder="Player Password">
        <button class="btn" onclick="doPlayerLogin()">View Profile</button>
      </div>
    </div>
  </div>

  <div id="admin" class="view hidden">
    <div class="card">
      <h3>üì¢ Announcements</h3>
      <input type="text" id="ann-msg" placeholder="Write message...">
      <select id="ann-prio"><option value="High">High Priority</option><option value="Low">Low Priority</option></select>
      <button class="btn" onclick="api('addAnnouncement', {id: Date.now(), message: val('ann-msg'), priority: val('ann-prio'), date: new Date()})">Post Announcement</button>
      <div id="adm-ann-list" style="margin-top: 15px;"></div>
    </div>

    <div class="card">
      <h3>üë§ Add Player</h3>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <input type="text" id="p-name" placeholder="Full Name">
        <input type="password" id="p-pass" placeholder="Set Password">
      </div>
      <button class="btn" onclick="api('addPlayer', {id: 'P'+Date.now(), name: val('p-name'), role: 'All-Rounder', password: val('p-pass'), team: 'Free Agent'})">Register Player</button>
      <div id="adm-player-list" style="margin-top: 15px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <div class="card">
      <h3>üìÖ Create Fixture</h3>
      <select id="adm-tourn"></select>
      <input type="text" id="m-stage" placeholder="Stage (e.g. Semi Final)">
      <input type="date" id="m-date">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
        <input type="text" id="m-teamA" placeholder="Team A">
        <input type="text" id="m-teamB" placeholder="Team B">
      </div>
      <button class="btn" onclick="api('addMatch', {id: 'M'+Date.now(), tournId: val('adm-tourn'), stage: val('m-stage'), date: val('m-date'), teamA: val('m-teamA'), teamB: val('m-teamB')})">Schedule Match</button>
    </div>

    <div class="card">
      <h3>üìù Update Scores</h3>
      <select id="score-match" onchange="enableScoring()"></select>
      
      <div id="score-box" class="hidden">
        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 15px; border: 1px solid #eee;">
           <label style="font-weight:bold; color:#0061ff;">1. Select Player</label>
           <select id="score-player"></select>
           
           <label style="font-weight:bold; color:#0061ff;">2. Playing For Team?</label>
           <select id="score-team-select"><option value="">Select Team...</option></select>

           <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
             <input type="number" id="s-runs" placeholder="Runs">
             <input type="number" id="s-wkt" placeholder="Wkts">
             <input type="number" id="s-ovr" placeholder="Overs">
           </div>
           <button class="btn" style="background: #333;" onclick="queueStat()">+ Add Stat</button>
        </div>

        <div id="stat-queue" style="margin: 15px 0; font-size: 0.9rem; color: #0061ff;"></div>
        
        <input type="text" id="s-winner" placeholder="Winner Team Name">
        <button class="btn" onclick="submitResult()">Finalize Result</button>
      </div>
    </div>
  </div>

  <div id="profile" class="view hidden">
    <div class="card" style="text-align: center;">
      <div style="width: 80px; height: 80px; background: #eef2ff; border-radius: 50%; margin: 0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:2rem;">üë§</div>
      <h2 id="prof-name"></h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;">
        <div style="background: linear-gradient(135deg, #0061ff, #60efff); color: white; padding: 20px; border-radius: 15px;">
          <div style="font-size: 2.5rem; font-weight: 800;" id="prof-runs">0</div>
          <div style="font-size: 0.8rem; font-weight: 600;">TOTAL RUNS</div>
        </div>
        <div style="background: linear-gradient(135deg, #FF512F, #DD2476); color: white; padding: 20px; border-radius: 15px;">
          <div style="font-size: 2.5rem; font-weight: 800;" id="prof-wkts">0</div>
          <div style="font-size: 0.8rem; font-weight: 600;">TOTAL WICKETS</div>
        </div>
      </div>

      <h3 style="margin-top: 30px; text-align: left; color:#2c3e50;">Match History</h3>
      <table id="prof-history">
        <thead><tr><th>Date</th><th>For Team</th><th>vs</th><th>Perf</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

</div>

<script>
// --- CONFIGURATION ---
const API_URL = "https://script.google.com/macros/s/AKfycbwVPV_BiScvuiWgvOjepsfZTRkfFmZKUwVc8UGv4VEetiOHNDv8P9qjKqD8XLnl0gvT/exec";

let DB = {};
let statQueue = [];
let currentUser = null;

// --- INIT ---
window.onload = async () => {
  await loadData();
  setInterval(updateCountdown, 1000);
};

// --- CORE DATA ---
async function loadData() {
  document.getElementById('loader').classList.remove('hidden');
  try {
    const res = await fetch(API_URL + "?action=getAllData");
    DB = await res.json();
    refreshUI();
  } catch(e) { console.error(e); alert("Failed to load data. Please refresh."); }
  document.getElementById('loader').classList.add('hidden');
}

function refreshUI() {
  if(DB.announcements) {
    const text = DB.announcements.map(a => `‚òÖ ${a.Message}`).join("   ");
    document.getElementById('ticker-text').innerText = text;
  }
  
  renderHome();
  renderRankings();
  renderTeams();
  populateDropdowns();
  
  if(!document.getElementById('admin').classList.contains('hidden')) renderAdminLists();
}

// --- RENDERERS ---
function renderHome() {
  const tbody = document.querySelector('#match-table tbody');
  tbody.innerHTML = "";
  
  const sorted = [...DB.matches].sort((a,b) => new Date(b.Date) - new Date(a.Date));
  
  sorted.forEach(m => {
    const t = DB.tournaments.find(x => x.ID == m.TournamentID);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${new Date(m.Date).toLocaleDateString()}</td>
      <td>
        <div style="font-weight:bold; color:#2c3e50;">${m.TeamA} <span style="color:#aaa">vs</span> ${m.TeamB}</div>
        <div style="font-size:0.8rem; color:#7f8c8d;">${t ? t.Name : ''} | ${m.Stage}</div>
      </td>
      <td>${m.Winner ? `<span style="color:#00c853; font-weight:bold;">${m.Winner} Won</span>` : `<span style="color:#0061ff; font-weight:bold;">Upcoming</span>`}</td>
    `;
    tr.onclick = () => openMatchModal(m);
    tbody.appendChild(tr);
  });

  // Countdown
  const future = DB.matches.filter(m => new Date(m.Date) > new Date()).sort((a,b) => new Date(a.Date) - new Date(b.Date))[0];
  if(future) {
    window.nextEvent = new Date(future.Date);
    document.getElementById('next-match-vs').innerHTML = `${future.TeamA} <span style="opacity:0.7">VS</span> ${future.TeamB}`;
  } else {
    document.getElementById('next-match-vs').innerText = "No Scheduled Matches";
    document.getElementById('countdown').innerText = "-- : --";
  }
}

function updateCountdown() {
  if(!window.nextEvent) return;
  const diff = window.nextEvent - new Date();
  if(diff <= 0) { document.getElementById('countdown').innerText="LIVE"; return; }
  
  const d = Math.floor(diff / (1000 * 60 * 60 * 24));
  const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
  document.getElementById('countdown').innerText = `${d}d ${h}h ${m}m`;
}

function renderRankings() {
  const sFilter = val('f-seas');
  const tFilter = val('f-tourn');
  let stats = {};

  DB.stats.forEach(s => {
    const m = DB.matches.find(x => x.MatchID == s.MatchID);
    if(!m) return;
    const t = DB.tournaments.find(x => x.ID == m.TournamentID);
    
    if(sFilter !== "All" && t.Season != sFilter) return;
    if(tFilter !== "All" && t.ID != tFilter) return;

    if(!stats[s.PlayerID]) stats[s.PlayerID] = {name: "", runs: 0, wkts: 0};
    const p = DB.players.find(x => x.ID == s.PlayerID);
    stats[s.PlayerID].name = p ? p.Name : "Unknown";
    stats[s.PlayerID].runs += Number(s.Runs);
    stats[s.PlayerID].wkts += Number(s.Wickets);
  });

  const tbody = document.querySelector('#p-rank-table tbody');
  tbody.innerHTML = "";
  Object.values(stats).sort((a,b) => b.runs - a.runs).forEach((p,i) => {
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${p.name}</td><td>${p.runs}</td><td>${p.wkts}</td></tr>`;
  });
}

function renderTeams() {
   let teams = {};
   DB.matches.filter(m => m.Status === "Completed").forEach(m => {
      [m.TeamA, m.TeamB].forEach(tm => {
         if(!teams[tm]) teams[tm] = {mat:0, won:0, lost:0};
         teams[tm].mat++;
         if(m.Winner === tm) teams[tm].won++; else teams[tm].lost++;
      });
   });
   const tbody = document.querySelector('#t-rank-table tbody');
   tbody.innerHTML = "";
   Object.keys(teams).sort((a,b) => teams[b].won - teams[a].won).forEach(tm => {
      tbody.innerHTML += `<tr><td>${tm}</td><td>${teams[tm].mat}</td><td>${teams[tm].won}</td><td>${teams[tm].lost}</td></tr>`;
   });
}

// --- MATCH MODAL ---
function openMatchModal(m) {
  const t = DB.tournaments.find(x => x.ID == m.TournamentID);
  document.getElementById('m-modal-title').innerText = `${m.TeamA} vs ${m.TeamB}`;
  document.getElementById('m-modal-info').innerText = `${t ? t.Name : ''} - ${new Date(m.Date).toLocaleDateString()}`;
  document.getElementById('m-modal-winner').innerText = m.Winner ? `WINNER: ${m.Winner}` : "PENDING";
  
  const tbody = document.querySelector('#m-modal-stats tbody');
  tbody.innerHTML = "";
  
  const matchStats = DB.stats.filter(s => s.MatchID == m.MatchID);
  
  if(matchStats.length === 0) {
    tbody.innerHTML = "<tr><td colspan='4' style='text-align:center'>No stats recorded yet.</td></tr>";
  } else {
    matchStats.forEach(s => {
       const p = DB.players.find(x => x.ID == s.PlayerID);
       // Uses the saved team name for that match
       let teamName = s.Team || (p ? p.Team : "-"); 
       
       tbody.innerHTML += `<tr>
         <td>${p ? p.Name : 'Unknown'}</td>
         <td>${teamName}</td>
         <td>${s.Runs}</td>
         <td>${s.Wickets}</td>
       </tr>`;
    });
  }
  document.getElementById('match-modal').classList.remove('hidden');
}
function closeModal() { document.getElementById('match-modal').classList.add('hidden'); }

// --- ADMIN & LOGIC ---
function api(action, payload) {
  payload.action = action;
  payload.password = "9908";
  
  document.getElementById('loader').classList.remove('hidden');
  fetch(API_URL, {
    method: 'POST', mode: 'no-cors', body: JSON.stringify(payload)
  }).then(() => {
     setTimeout(() => { 
       loadData(); 
       if(action === 'addMatch') alert("Fixture Created");
     }, 1500);
  });
}

function enableScoring() {
  const mid = val('score-match');
  const match = DB.matches.find(m => m.MatchID == mid);
  const teamSelect = document.getElementById('score-team-select');
  
  if(match) {
    // Populate team select with ONLY the playing teams
    teamSelect.innerHTML = `<option value="${match.TeamA}">${match.TeamA}</option>
                            <option value="${match.TeamB}">${match.TeamB}</option>`;
    
    document.getElementById('score-box').classList.remove('hidden');
    statQueue = []; document.getElementById('stat-queue').innerHTML = "";
  }
}

function queueStat() {
  const pid = val('score-player');
  const teamName = val('score-team-select');
  const name = document.getElementById('score-player').options[document.getElementById('score-player').selectedIndex].text;
  
  if(!teamName) { alert("Please select which team the player played for!"); return; }

  const item = {
    linkId: "L"+Date.now(),
    matchId: val('score-match'),
    playerId: pid,
    runs: val('s-runs')||0,
    wickets: val('s-wkt')||0,
    overs: val('s-ovr')||0,
    catches: 0,
    teamName: teamName
  };
  
  statQueue.push(item);
  document.getElementById('stat-queue').innerHTML += `<div>+ ${name} (${teamName}): ${item.runs}R, ${item.wickets}W</div>`;
  
  api('addStat', item); 
}

function submitResult() {
  api('updateMatchResult', {matchId: val('score-match'), winner: val('s-winner')});
}

// --- PROFILE ---
function renderProfile(p) {
  document.getElementById('prof-name').innerText = p.Name;
  const pStats = DB.stats.filter(s => s.PlayerID == p.ID);
  
  let totalRuns = 0; let totalWkts = 0;
  const tbody = document.querySelector('#prof-history tbody');
  tbody.innerHTML = "";
  
  pStats.forEach(s => {
     totalRuns += Number(s.Runs); totalWkts += Number(s.Wickets);
     const m = DB.matches.find(x => x.MatchID == s.MatchID);
     if(m) {
       const playedFor = s.Team || "Flex"; 
       const opponent = (playedFor === m.TeamA) ? m.TeamB : m.TeamA;
       
       tbody.innerHTML += `<tr>
         <td>${new Date(m.Date).toLocaleDateString()}</td>
         <td>${playedFor}</td>
         <td>vs ${opponent}</td>
         <td>${s.Runs}R / ${s.Wickets}W</td>
       </tr>`;
     }
  });
  
  document.getElementById('prof-runs').innerText = totalRuns;
  document.getElementById('prof-wkts').innerText = totalWkts;
}

// --- UTILS ---
function nav(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  const btn = document.getElementById('btn-'+id);
  if(btn) btn.classList.add('active');
}

function val(id) { return document.getElementById(id).value; }

function toggleLogin() {
  const role = val('login-role');
  document.getElementById('admin-login-box').classList.toggle('hidden', role !== 'admin');
  document.getElementById('player-login-box').classList.toggle('hidden', role !== 'player');
}

function doAdminLogin() {
  if(val('admin-pass') === "9908") {
    nav('admin');
    document.getElementById('btn-admin').classList.remove('hidden');
    renderAdminLists();
  } else alert("Access Denied");
}

function doPlayerLogin() {
  const pid = val('login-pid');
  const pass = val('player-pass');
  const p = DB.players.find(x => x.ID == pid && x.Password == pass);
  if(p) {
    currentUser = p;
    document.getElementById('btn-profile').classList.remove('hidden');
    renderProfile(p);
    nav('profile');
  } else alert("Invalid Credentials");
}

function renderAdminLists() {
  const pl = document.getElementById('adm-player-list');
  pl.innerHTML = "";
  DB.players.forEach(p => {
    pl.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; font-size:0.9rem;">
      <span>${p.Name}</span>
      <span style="color:red; cursor:pointer;" onclick="api('deletePlayer', {id:'${p.ID}'})">DELETE</span>
    </div>`;
  });
  
  const al = document.getElementById('adm-ann-list');
  al.innerHTML = "";
  DB.announcements.forEach(a => {
    al.innerHTML += `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #eee; font-size:0.9rem;">
      <span>${a.Message}</span>
      <span style="color:red; cursor:pointer;" onclick="api('deleteAnnouncement', {id:'${a.ID}'})">DELETE</span>
    </div>`;
  });
}

function populateDropdowns() {
  const pOpts = DB.players.map(p => `<option value="${p.ID}">${p.Name}</option>`).join("");
  document.getElementById('login-pid').innerHTML = pOpts;
  document.getElementById('score-player').innerHTML = pOpts;
  
  const tOpts = DB.tournaments.map(t => `<option value="${t.ID}">${t.Name}</option>`).join("");
  document.getElementById('adm-tourn').innerHTML = tOpts;
  document.getElementById('f-tourn').innerHTML += tOpts;
  
  const mOpts = DB.matches.filter(m => m.Status !== "Completed").map(m => `<option value="${m.MatchID}">${m.TeamA} vs ${m.TeamB}</option>`).join("");
  document.getElementById('score-match').innerHTML = "<option>Select Match...</option>" + mOpts;
}
</script>
</body>
</html>
